#!/usr/bin/env python3
"""
Sherlock Bot - PREMIUM –≤–µ—Ä—Å–∏—è
–°—Å—ã–ª–∫–∏ —Ç–æ–ª—å–∫–æ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º, –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è
"""

import sys
import time
import json
import re
import requests
from datetime import datetime, timedelta

print("\n" + "="*60)
print("ü§ñ SHERLOCK BOT - PREMIUM –í–ï–†–°–ò–Ø")
print("="*60)

# –¢–û–ö–ï–ù –ë–û–¢–ê
BOT_TOKEN = "8563524169:AAF3m0ZOGM1ghXVcOAmqZrccc2o_FIEsf6c"
API_URL = f"https://api.telegram.org/bot{BOT_TOKEN}"

# –°–ê–ô–¢–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò
SITES = {
    "GitHub": "https://github.com/{}",
    "Twitter/X": "https://twitter.com/{}",
    "Instagram": "https://instagram.com/{}",
    "VK": "https://vk.com/{}",
    "Telegram": "https://t.me/{}",
    "YouTube": "https://youtube.com/@{}",
    "Reddit": "https://reddit.com/user/{}",
    "Steam": "https://steamcommunity.com/id/{}",
    "Twitch": "https://twitch.tv/{}",
    "TikTok": "https://tiktok.com/@{}",
    "Pinterest": "https://pinterest.com/{}",
    "Facebook": "https://facebook.com/{}",
    "LinkedIn": "https://linkedin.com/in/{}",
    "Discord": "https://discord.com/users/{}",
    "GitLab": "https://gitlab.com/{}",
    "Habr": "https://habr.com/ru/users/{}",
}

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
users_db = {}
MAX_CHECKS = 3
PROMO_CODE = "6a57b3b865834a"  # –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –ü–†–û–ú–û–ö–û–î

def send_message(chat_id, text, reply_markup=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    url = f"{API_URL}/sendMessage"
    data = {
        "chat_id": chat_id,
        "text": text,
        "parse_mode": "Markdown",
        "disable_web_page_preview": True
    }
    
    if reply_markup:
        data["reply_markup"] = json.dumps(reply_markup)
    
    try:
        response = requests.post(url, json=data, timeout=10)
        return response.json()
    except:
        return None

def edit_message(chat_id, message_id, text, reply_markup=None):
    """–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    url = f"{API_URL}/editMessageText"
    data = {
        "chat_id": chat_id,
        "message_id": message_id,
        "text": text,
        "parse_mode": "Markdown"
    }
    
    if reply_markup:
        data["reply_markup"] = json.dumps(reply_markup)
    
    try:
        requests.post(url, json=data, timeout=10)
    except:
        pass

def get_updates(offset=None):
    """–ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    url = f"{API_URL}/getUpdates"
    params = {"timeout": 30}
    if offset:
        params["offset"] = offset
    
    try:
        response = requests.get(url, params=params, timeout=35)
        return response.json()
    except:
        return {"ok": False, "result": []}

def check_username(username):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç username"""
    results = {"found": [], "not_found": []}
    
    for site, url_template in SITES.items():
        url = url_template.format(username)
        
        try:
            response = requests.get(
                url,
                timeout=5,
                headers={'User-Agent': 'Mozilla/5.0'},
                allow_redirects=True
            )
            
            if response.status_code == 200:
                text = response.text.lower()
                if any(x in text for x in ['not found', '–Ω–µ –Ω–∞–π–¥–µ–Ω', '—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞']):
                    results["not_found"].append(site)
                else:
                    results["found"].append({"site": site, "url": url})
            else:
                results["not_found"].append(site)
                
        except:
            results["not_found"].append(site)
    
    return results

def search_by_phone(phone):
    """–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ë–ï–¢–ê)"""
    # –≠—Ç–æ –ë–ï–¢–ê-—Ñ—É–Ω–∫—Ü–∏—è, –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã —Å–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫
    results = []
    
    # –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
    fake_sites = [
        {"site": "Telegram", "url": f"https://t.me/+{phone}"},
        {"site": "WhatsApp", "url": f"https://wa.me/{phone}"},
        {"site": "VK (–≤–æ–∑–º–æ–∂–Ω–æ)", "url": "https://vk.com/"},
    ]
    
    # –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ–∏—Å–∫–∞
    time.sleep(2)
    
    return fake_sites

def get_user_data(user_id):
    """–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    now = datetime.now()
    
    if user_id not in users_db:
        users_db[user_id] = {
            "checks_today": 0,
            "last_date": now.strftime("%Y-%m-%d"),
            "has_promo": False,  # –ï—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø –∫ —Å—Å—ã–ª–∫–∞–º
            "total_checks": 0
        }
    
    user = users_db[user_id]
    
    # –°–±—Ä–æ—Å –µ—Å–ª–∏ –Ω–æ–≤—ã–π –¥–µ–Ω—å
    if user["last_date"] != now.strftime("%Y-%m-%d"):
        user["checks_today"] = 0
        user["last_date"] = now.strftime("%Y-%m-%d")
    
    return user

def can_check(user_id):
    """–ú–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É"""
    user = get_user_data(user_id)
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ - –±–µ–∑–ª–∏–º–∏—Ç
    if user["has_promo"]:
        user["total_checks"] += 1
        return True
    
    if user["checks_today"] < MAX_CHECKS:
        user["checks_today"] += 1
        user["total_checks"] += 1
        return True
    
    return False

def activate_promo(user_id, code):
    """–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥"""
    if code == PROMO_CODE:
        user = get_user_data(user_id)
        user["has_promo"] = True
        user["checks_today"] = 0  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–∏–º–∏—Ç
        return True
    return False

def handle_start(chat_id, user_name):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ /start"""
    message = f"""üîç *SHERLOCK BOT*

*–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ username –Ω–∞ 15+ —Å–∞–π—Ç–∞—Ö
‚úì –ü–æ–∫–∞–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
‚úì {MAX_CHECKS} –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –¥–µ–Ω—å

*Premium —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–º–æ–∫–æ–¥):*
‚úì –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏
‚úì –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚úì –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ë–ï–¢–ê)

*–ö–æ–º–∞–Ω–¥—ã:*
/check username - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å username
/phone –Ω–æ–º–µ—Ä - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É (–ë–ï–¢–ê)
/limit - –º–æ–∏ –ª–∏–º–∏—Ç—ã
/help - –ø–æ–º–æ—â—å

üìù –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ username –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!"""
    
    send_message(chat_id, message)

def handle_help(chat_id):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ /help"""
    message = """*üìã –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:*

*1. –ü—Ä–æ–≤–µ—Ä–∫–∞ username:*
`/check github` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å username
–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ username

*2. –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É (–ë–ï–¢–ê):*
`/phone 79123456789` - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É
‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–º–æ–∫–æ–¥!

*3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:*
`/limit` - –ø–æ–∫–∞–∑–∞—Ç—å –ª–∏–º–∏—Ç—ã
`/help` - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

*‚ö° –û –ë–û–¢–ï:*
‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
‚Ä¢ –° –ø—Ä–æ–º–æ–∫–æ–¥–æ–º: –¥–∞—ë—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ + –±–µ–∑–ª–∏–º–∏—Ç
‚Ä¢ –ë–ï–¢–ê: –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
    
    send_message(chat_id, message)

def handle_check(chat_id, username):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ username"""
    user = get_user_data(chat_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
    if not user["has_promo"] and user["checks_today"] >= MAX_CHECKS:
        send_message(chat_id, 
            f"‚ùå *–õ–ò–ú–ò–¢ –ò–°–ß–ï–†–ü–ê–ù!*\n\n"
            f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {MAX_CHECKS}/{MAX_CHECKS} –ø—Ä–æ–≤–µ—Ä–æ–∫\n"
            f"üîÑ –û–±–Ω–æ–≤–∏—Ç—Å—è –≤ 00:00\n\n"
            f"–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –∏ –±–µ–∑–ª–∏–º–∏—Ç–∞ –Ω—É–∂–µ–Ω –ø—Ä–æ–º–æ–∫–æ–¥.")
        return
    
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞
    if not user["has_promo"]:
        user["checks_today"] += 1
    user["total_checks"] += 1
    
    # –£–±–∏—Ä–∞–µ–º @ –µ—Å–ª–∏ –µ—Å—Ç—å
    if username.startswith('@'):
        username = username[1:]
    
    # –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ
    msg = send_message(chat_id, f"üîç *–ò—â—É* `{username}` *–Ω–∞ {len(SITES)} —Å–∞–π—Ç–∞—Ö...*")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º
    results = check_username(username)
    found = results["found"]
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    response = f"üîç *–†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–õ–Ø:* `{username}`\n\n"
    
    if found:
        response += f"‚úÖ *–ù–ê–ô–î–ï–ù–û –ü–†–û–§–ò–õ–ï–ô:* {len(found)}\n\n"
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏
        if user["has_promo"]:
            response += "*–ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–§–ò–õ–ò:*\n"
            for i, profile in enumerate(found, 1):
                response += f"{i}. [{profile['site']}]({profile['url']})\n"
            response += "\n‚ö†Ô∏è *–ë–ï–¢–ê-–≤–µ—Ä—Å–∏—è —Å—Å—ã–ª–æ–∫*"
        else:
            response += f"*–°—Å—ã–ª–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ PREMIUM –≤–µ—Ä—Å–∏–∏*\n"
            response += f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫\n\n"
            
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–∞–π—Ç–æ–≤ –±–µ–∑ —Å—Å—ã–ª–æ–∫
            site_names = [p["site"] for p in found]
            response += f"*–ù–∞–π–¥–µ–Ω–æ –Ω–∞:* {', '.join(site_names[:8])}"
            if len(site_names) > 8:
                response += f" –∏ –µ—â—ë {len(site_names)-8} —Å–∞–π—Ç–∞—Ö"
    
    else:
        response += "‚ùå *–ü–†–û–§–ò–õ–ò –ù–ï –ù–ê–ô–î–ï–ù–´*\n"
    
    response += f"\nüìä *–°–¢–ê–¢–ò–°–¢–ò–ö–ê:*\n"
    response += f"‚Ä¢ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–∞–π—Ç–æ–≤: {len(SITES)}\n"
    response += f"‚Ä¢ –ù–∞–π–¥–µ–Ω–æ: {len(found)}\n"
    response += f"‚Ä¢ –ù–µ –Ω–∞–π–¥–µ–Ω–æ: {len(results['not_found'])}\n"
    
    if user["has_promo"]:
        response += f"‚Ä¢ –°—Ç–∞—Ç—É—Å: üéâ PREMIUM (–±–µ–∑–ª–∏–º–∏—Ç)\n"
    else:
        checks_left = MAX_CHECKS - user["checks_today"]
        response += f"‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–æ–∫: {checks_left}\n"
        response += f"‚Ä¢ –î–ª—è —Å—Å—ã–ª–æ–∫ –Ω—É–∂–µ–Ω –ø—Ä–æ–º–æ–∫–æ–¥\n"
    
    send_message(chat_id, response)

def handle_phone_search(chat_id, phone):
    """–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ - –¢–û–õ–¨–ö–û –° –ü–†–û–ú–û–ö–û–î–û–ú!"""
    user = get_user_data(chat_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥
    if not user["has_promo"]:
        send_message(chat_id,
            "‚ùå *–î–û–°–¢–£–ü –ó–ê–ö–†–´–¢!*\n\n"
            "–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ:\n"
            "‚úÖ –° –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–æ–º–æ–∫–æ–¥–æ–º\n"
            "‚ö†Ô∏è –≠—Ç–æ –ë–ï–¢–ê-—Ñ—É–Ω–∫—Ü–∏—è\n\n"
            "–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥.")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞
    phone = phone.replace('+', '').replace(' ', '').replace('-', '')
    if not phone.isdigit() or len(phone) < 10:
        send_message(chat_id, "‚ùå *–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞!*\n\n–ü—Ä–∏–º–µ—Ä: `79123456789` –∏–ª–∏ `+79123456789`")
        return
    
    # –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫
    msg = send_message(chat_id, f"üì± *–ò—â—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –Ω–æ–º–µ—Ä—É:* `{phone}`\n‚ö†Ô∏è *–ë–ï–¢–ê-–≤–µ—Ä—Å–∏—è –ø–æ–∏—Å–∫–∞*")
    
    # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫
    time.sleep(3)
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
    results = search_by_phone(phone)
    
    response = f"üì± *–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ü–û –ù–û–ú–ï–†–£:*\n`{phone}`\n\n"
    response += f"‚ö†Ô∏è *–ë–ï–¢–ê-–≤–µ—Ä—Å–∏—è –ø–æ–∏—Å–∫–∞*\n\n"
    
    if results:
        response += f"‚úÖ *–ù–ê–ô–î–ï–ù–ê –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ù–ê {len(results)} –°–ê–ô–¢–ê–•:*\n\n"
        
        for i, result in enumerate(results, 1):
            response += f"{i}. *{result['site']}*\n"
            if 'url' in result:
                response += f"   üîó {result['url']}\n"
        
        response += "\n*‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ë–ï–¢–ê-–í–ï–†–°–ò–Ø*\n"
        response += "‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏\n"
        response += "‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
        response += "‚Ä¢ –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ"
    else:
        response += "‚ùå *–ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–û –ù–û–ú–ï–†–£ –ù–ï –ù–ê–ô–î–ï–ù–ê*\n\n"
        response += "‚ö†Ô∏è *–ü—Ä–∏—á–∏–Ω—ã:*\n"
        response += "‚Ä¢ –ù–æ–º–µ—Ä –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö\n"
        response += "‚Ä¢ –ë–ï–¢–ê-–≤–µ—Ä—Å–∏—è –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n"
        response += "‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤"
    
    response += f"\n\nüîí *–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º*"
    
    send_message(chat_id, response)

def handle_promo(chat_id, code):
    """–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞"""
    if activate_promo(chat_id, code):
        message = """üéâ *PROMO CODE –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!*

‚úÖ *–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω–æ:*
1. üöÄ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ username
2. üîó –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
3. üì± –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ë–ï–¢–ê)
4. ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

‚ö†Ô∏è *–ë–ï–¢–ê-—Ñ—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ –°—Å—ã–ª–∫–∏: –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è
‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É: –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è
‚Ä¢ –¢–æ—á–Ω–æ—Å—Ç—å: 85-95%

üîç *–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
`/check username` - —Å —Å—Å—ã–ª–∫–∞–º–∏
`/phone –Ω–æ–º–µ—Ä` - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É"""
        
        send_message(chat_id, message)
    else:
        send_message(chat_id, "‚ùå *–ù–ï–í–ï–†–ù–´–ô –ü–†–û–ú–û–ö–û–î*")

def handle_limit(chat_id):
    """–ü–æ–∫–∞–∑–∞—Ç—å –ª–∏–º–∏—Ç—ã"""
    user = get_user_data(chat_id)
    
    if user["has_promo"]:
        message = f"""üéâ *PREMIUM –î–û–°–¢–£–ü –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!*

‚úÖ *–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*
‚Ä¢ üîó –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏
‚Ä¢ üöÄ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚Ä¢ üì± –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É (–ë–ï–¢–ê)
‚Ä¢ ‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

üìä *–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*
–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: {user['total_checks']}

‚ö†Ô∏è *–ë–ï–¢–ê-–≤–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–π:* —Å—Å—ã–ª–∫–∏ –∏ –ø–æ–∏—Å–∫"""
    else:
        checks_left = MAX_CHECKS - user["checks_today"]
        message = f"""üìä *–í–ê–®–ò –õ–ò–ú–ò–¢–´:*

‚Ä¢ –ü—Ä–æ–≤–µ—Ä–æ–∫ —Å–µ–≥–æ–¥–Ω—è: {user['checks_today']}/{MAX_CHECKS}
‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–æ–∫: {checks_left}
‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: {user['total_checks']}

üîí *PREMIUM —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã:*
‚Ä¢ –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏
‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏  
‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞

üîÑ –õ–∏–º–∏—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è –≤ 00:00"""
    
    send_message(chat_id, message)

def process_update(update):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    try:
        if "message" not in update:
            return False
        
        msg = update["message"]
        chat_id = msg["chat"]["id"]
        text = msg.get("text", "").strip()
        
        if not text:
            return False
        
        # –ö–æ–º–∞–Ω–¥–∞ /start
        if text == "/start":
            user_name = msg["chat"].get("first_name", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å")
            handle_start(chat_id, user_name)
        
        # –ö–æ–º–∞–Ω–¥–∞ /help
        elif text == "/help":
            handle_help(chat_id)
        
        # –ö–æ–º–∞–Ω–¥–∞ /limit
        elif text == "/limit":
            handle_limit(chat_id)
        
        # –ö–æ–º–∞–Ω–¥–∞ /promo
        elif text.startswith("/promo "):
            parts = text.split()
            if len(parts) >= 2:
                handle_promo(chat_id, parts[1])
            else:
                send_message(chat_id, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `/promo –ö–û–î`")
        
        # –ö–æ–º–∞–Ω–¥–∞ /check
        elif text.startswith("/check "):
            parts = text.split()
            if len(parts) >= 2:
                handle_check(chat_id, parts[1])
            else:
                send_message(chat_id, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `/check username`")
        
        # –ö–æ–º–∞–Ω–¥–∞ /phone
        elif text.startswith("/phone "):
            parts = text.split()
            if len(parts) >= 2:
                handle_phone_search(chat_id, parts[1])
            else:
                send_message(chat_id, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `/phone –Ω–æ–º–µ—Ä`\n–ü—Ä–∏–º–µ—Ä: `/phone 79123456789`")
        
        # –ü—Ä–æ—Å—Ç–æ username (–±–µ–∑ –∫–æ–º–∞–Ω–¥—ã)
        elif text and not text.startswith('/') and ' ' not in text and len(text) > 1:
            handle_check(chat_id, text)
        
        return True
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
        return False

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("\n[1/2] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞...")
    
    try:
        test = requests.get(f"{API_URL}/getMe", timeout=10)
        if not test.json().get("ok"):
            print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω!")
            return
        bot_name = test.json()["result"]["username"]
        print(f"‚úÖ –ë–æ—Ç: @{bot_name}")
    except:
        print("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è!")
        return
    
    print("[2/2] –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
    print(f"\n‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:")
    print(f"‚Ä¢ –°–∞–π—Ç–æ–≤: {len(SITES)}")
    print(f"‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: {MAX_CHECKS}/–¥–µ–Ω—å")
    print(f"‚Ä¢ –ü—Ä–æ–º–æ–∫–æ–¥: {PROMO_CODE}")
    print(f"‚Ä¢ –ë–ï–¢–ê-—Ñ—É–Ω–∫—Ü–∏–∏: –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É")
    
    print("\n" + "="*60)
    print("ü§ñ –ë–û–¢ –ó–ê–ü–£–©–ï–ù!")
    print("="*60 + "\n")
    
    last_update_id = 0
    
    while True:
        try:
            updates = get_updates(last_update_id + 1)
            
            if updates.get("ok"):
                for update in updates["result"]:
                    update_id = update["update_id"]
                    
                    if update_id > last_update_id:
                        last_update_id = update_id
                        process_update(update)
            
            time.sleep(0.5)
            
        except KeyboardInterrupt:
            print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            break
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞: {e}")
            time.sleep(5)

if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")
